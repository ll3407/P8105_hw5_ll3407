---
title: "p8105_hw5_ll3407"
output: github_document
date: "2022-11-10"
---

```{r, include= FALSE, message = FALSE, warning = FALSE}
library(tidyverse)
library(rvest)

knitr::opts_chunk$set(
	echo = TRUE,
	warning = FALSE,
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%"
)
theme_set(theme_minimal() + theme(legend.position = "bottom"))
options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)
scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```


##Problem 1

```{r, eval = FALSE, include= FALSE}
file_name = list.files(path = "./data", 
                       pattern = ".csv", 
                       all.files = FALSE, 
                       full.names = FALSE, 
                       recursive = FALSE, 
                       ignore.case = FALSE,
                       include.dirs = FALSE, 
                       no.. = FALSE) %>% view()
 
    file_name_2 = 
      list(
        arm = str_extract_all(file_name,"[c-e][o-x][n-p]"), 
        subject_id = str_extract(file_name, "[0-9]{1,2}")) %>% view()
  
```

```{r}
dataframe = file_name %>% 
  purrr::map_df(~read_csv(file.path("./data", .))) %>% 
  bind_cols(file_name) %>% 
  bind_cols(file_name_2) %>% 
  rename(arm = c..con....con....con....con....con....con....con....con....con...) %>% 
  rename(file =x) %>% 
  pivot_longer(week_1:week_8,
               names_to = "week",
               values_to = "estimate")%>% 
  group_by(file)

```

##Problem 2

# Input dataset and  create variable "city_state"
```{r}
homicide = read_csv(file = "./data/homicide-data.csv") %>%
  janitor::clean_names() %>% 
  mutate (new = homicide$new <-  do.call(paste, c(homicide[c("city", "state")], sep = ","))) %>% 
  mutate(city_state = new) %>% 
  select(-new)
  
head(homicide, n =30) %>% view()  
  
```
# summarize total number of homicide by city and unsolved homicide by city
```{r}
total = homicide %>% 
  group_by(city_state) %>%
  summarize(count=n())%>%
  rename(total_number = count) 

unsolved = homicide %>% 
    filter(disposition != "Closed by arrest") %>% 
    group_by(city_state) %>% 
    summarize(count=n()) %>% 
    rename(unsolved_number = count) 
```

Combine unsolved and total homicide dataset by city_state, and list it
```{r}
homicide_2 = left_join(total, unsolved, by = "city_state") %>% 
  arrange(desc(unsolved_number)) 

homicide_list<-vector("list",nrow(homicide_2))
for (i in 1:nrow(homicide_2)){
  homicide_list[[i]]<-homicide_2[i,]
} 

```

#Baltimore unsolved prop test
```{r}
Baltimore_2 =prop.test(x = 1825, n = 2827, p = NULL, 
    alternative =   c("two.sided"),
    conf.level = 0.95, correct = TRUE ) %>% 
  broom::tidy() %>% 
  select(estimate, conf.low, conf.high)
```

# function of prop.test 
```{r}
prop = function(a){
    
    test = prop.test(n = a$total_number, x = a$unsolved_number, p = NULL, 
    alternative =   c("two.sided"),
    conf.level = 0.95, correct = TRUE ) 
    
  broom::tidy(test) %>% 
  select(estimate, conf.low, conf.high)
  
}

```


```{r}
output = vector("list",length = 50)
for(i in 1:50){
  output[[i]] = prop(homicide_list[[i]])
}
  

output=
 purrr::map(.x = homicide_list, ~prop(.x), .default = NA_character_)

```

```{r}
library(purrr)

homicide_3 = homicide_2 %>% 
  mutate(proportion = output)
  
```

## Problem 3
# t.test for normal distribution (mu=0)
```{r}
set.seed(1)

normal = function(n = 30, mu = 0, sigma = 5){
  x = rnorm(n = 30, mean = mu, sd = sigma)
  
  t.test(x, alternative = c("two.sided"),
         mu = 0, paired = FALSE, var.equal = FALSE,
         conf.level = 0.95) %>% 
    broom::tidy() %>% 
    select(estimate, p.value)
  
}

output = vector("list", length = 5000)
for (i in 1:5000){
  output[[i]] = normal(n=30, mu=0, sigma=5)
}

bind_rows(output) %>% view()
```

## t.test for normal distribution (mu=1-5)
```{r}
normal = function(n = 30, mu, sigma = 5){
  x = rnorm(n = 30, mean = mu, sd = sigma)
  
  t.test(x, alternative = c("two.sided"),
         mu = 0, paired = FALSE, var.equal = FALSE,
         conf.level = 0.95) %>% 
    broom::tidy() %>% 
    select(estimate, p.value)
  
}

output2 = vector("list", length = 5000)
for (i in 1:5000){
  output2[[i]] = normal(n=30, mu=c(1,2,3,4,5), sigma=5)
}

bind_rows(output2) %>% view()
```

# make a plot showing the proportion of times the null was rejected
```{r}

```

